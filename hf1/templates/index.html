<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ADX - CHAT</title>
    <link rel="stylesheet" href="/static/main.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>
    <div class="chat-container">
        <h1>ADX - CHAT</h1>
        <div id="chat-box">
            {% if response %}
                <div class="message ai">
                    <pre id="raw" style="display:none;">{{ response }}</pre>
                    <div id="msg"></div>
                </div>
            {% endif %}
        </div>
        <form action="/" method="POST" class="chat-form">
            <input type="text" name="message" placeholder="Enter your message" required>
            <button type="submit">Send</button>
        </form>
    </div>

    <script>
        window.onload = function() {
            var rawEl = document.getElementById("raw");
            var msgEl = document.getElementById("msg");
            if (rawEl && msgEl) {
                var markdown = rawEl.innerText;
                marked.setOptions({
                    highlight: function(code, lang) {
                        if (lang && hljs.getLanguage(lang)) {
                            return hljs.highlight(code, { language: lang }).value;
                        }
                        return hljs.highlightAuto(code).value;
                    }
                });
                var html = marked.parse(markdown);
                msgEl.innerHTML = html;
                document.querySelectorAll('pre code').forEach((block) => {
                    hljs.highlightElement(block);
                });
            }
        };
    </script>
</body>
</html>
